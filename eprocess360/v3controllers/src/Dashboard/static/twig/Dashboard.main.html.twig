{% extends 'SystemController.plain.html.twig' %}

{% set active = 'dashboard' %}

{% block body %}
    <div class="row">
        <div class="col-sm-6">
            <h3>Existing</h3>
            <div class="list-group" style="margin-bottom:5px">
                {% for project in Response.projects|slice(0,5) %}
                    <a href="{{ SysVar.get('siteUrl') }}/projects/{{ project.idProject }}" class="list-group-item">
                        <h4 class="list-group-item-heading">{{ project.title }} {% if project.taskCount %}<span class="badge pull-right">{{ project.taskCount }}</span>{% endif %}</h4>
                        <p class="list-group-item-text">{{ project.description }}</p>
                    </a>
                {% else %}
                    <span class="list-group-item"><h4 class="list-group-item-heading">No projects</h4>
                            <p class="list-group-item-text">You don't have any projects.</p>
                            </span>
                {% endfor %}
            </div>
            <a href="{{ SysVar.get('siteUrl') }}/projects" class="pull-right" style="margin-bottom:20px">See All Projects</a>
        </div>
        <div class="col-sm-6">
            <h3>Create</h3>
            <div class="list-group">
                {% for controller in Response.controllers %}
                    <a id= "make-project" data-SiteUrl="{{ SysVar.get('siteUrl') }}" data-idController= "{{ controller.idController }}" class="list-group-item">
                        <h4 class="list-group-item-heading">New {{ controller.title }}</h4>
                        <p class="list-group-item-text">{{ controller.description }}</p>
                    </a>
                {% else %}
                    <div class="list-group-item"><h4 class="list-group-item-heading">No available workflows</h4>
                        <p class="list-group-item-text">You either don't have permission to start a new project, or there are no workflows configured.</p>
                    </div>
                {% endfor %}
            </div>
        </div>


    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Notice to Applicants
                </div>
                <div class="panel-body">
                    <p>If you are submitting responses to a plan check, please upload them to the Existing Project.</p>

                    <p>Temporary power is not included with new construction permits. A separate permit is required for temporary power.</p>

                </div>
            </div>
        </div>
    </div>

{% endblock %}
{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('#make-project').click(function() {
                var controller = this;

                $.ajax({
                    url: $(controller).attr('data-SiteUrl')+'/api/v1/controllers/'+$(controller).attr('data-idController')+'/projects',
                    type: 'POST',
                    data: null,
                    async: false,
                    dataType: 'json'
                }).done(function (data) {
                    window.location = $(controller).attr('data-SiteUrl')+'/controllers/'+$(controller).attr('data-idController')+'/projects/'+data.data.idProject;
                });
            });
        });
    </script>
{% endblock %}